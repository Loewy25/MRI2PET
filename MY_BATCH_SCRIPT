#!/bin/bash

#SBATCH --job-name=MGDA_UB
#SBATCH --mem=10G
#SBATCH -t 23:50:00
#SBATCH --gres=gpu:1
#SBATCH --partition=tier1_gpu
#SBATCH --account=shinjini_kundu
#SBATCH --exclude=gpua408
#SBATCH --output=slurm-%A_haha.out
#SBATCH --error=slurm-%A_haha.out

# ------------------------------------------------------------
# Environment setup
# ------------------------------------------------------------
module purge
module load cuda/12.9
module load cudnn/9.11.0.98-cuda12

# Properly source FreeSurfer so mri_vol2vol etc. are in PATH
if [ -n "$FREESURFER_HOME" ] && [ -f "$FREESURFER_HOME/SetUpFreeSurfer.sh" ]; then
  # shellcheck disable=SC1090
  source "$FREESURFER_HOME/SetUpFreeSurfer.sh"
fi

# Conda environment
. ~/miniconda3/bin/activate
conda activate pasta

# Ensure FSL writes NIfTI_GZ
export FSLOUTPUTTYPE=NIFTI_GZ


# ------------------------------------------------------------
# Main execution
# ------------------------------------------------------------

# Example optional commands (commented)
# ------------------------------------------------------------

python classification_cnn.py --csv /scratch/l.peiwang/MRI2PET_classfication/amy_dataset_manifest_with_pet_raw.csv --modality pet_raw





#python ROI_eval.py \
#   --roi-root /scratch/l.peiwang/kari_brainv33 \
#   --vols-root /home/l.peiwang/MRI2PET/MGDA_UB_v33/volumes \
#   --out /home/l.peiwang/MRI2PET/MGDA_UB_v33/roi_metrics \
#   --data-range 3.5 \
#   --mmd-voxels 2048

# python MI_ROI.py \
#   --root-dir /scratch/l.peiwang/kari_brainv11 \
#   --out /scratch/l.peiwang/kari_brainv11/mi_results_norm_vs_raw \
#   --bins 64 \
#   --verbose
# ------------------------------------------------------------

# Actual job
#python cv_creator.py \
#  --meta_csv /scratch/l.peiwang/MR_AMY_TAU_CDR_merge_DF26.csv \
#  --root /scratch/l.peiwang/braak_merged_300 \
#  --outdir /scratch/l.peiwang/braak_merged_300/CV5_braak_strat
#python summary.py
#python Data_T807.py --part 1


#python ROI_eval_cv.py \
#  --roi-root /scratch/l.peiwang/kari_brainv33_top300 \
#  --runs /home/l.peiwang/MRI2PET/tau_MGDA_UB_v33_500_1_1 \
#         /home/l.peiwang/MRI2PET/tau_MGDA_UB_v33_500_2 \
#         /home/l.peiwang/MRI2PET/tau_MGDA_UB_v33_500_3\
#         /home/l.peiwang/MRI2PET/tau_MGDA_UB_v33_500_4 \
#         /home/l.peiwang/MRI2PET/tau_MGDA_UB_v33_500_5 \
#  --out /home/l.peiwang/MRI2PET/tau_MGDA_UB_v33_500_1/roi_metrics \
#  --strict-affine
#pet_fake _mri pet_gt
#python Classification.py \
#  --root /home/l.peiwang/MRI2PET \
#  --meta_csv /scratch/l.peiwang/MR_AMY_TAU_CDR_merge_DF26.csv \
#  --session_col TAU_PET_Session \
#  --centiloid_col Centiloid \
#  --centiloid_thr 18.4 \
#  --modalities mri \
#  --outdir /scratch/l.peiwang/MRI2PET_svm_out_amyloid


#python Classification_csv.py \
#  --fake_base /home/l.peiwang/MRI2PET/ab_MGDA_UB_v33_500 \
#  --folds 1 2 3 4 5 \
#  --orig_root /scratch/l.peiwang/kari_brainv33_top300 \
#  --meta_csv /scratch/l.peiwang/MR_AMY_TAU_CDR_merge_DF26.csv \
#  --session_col TAU_PET_Session \
#  --out_csv /scratch/l.peiwang/MRI2PET_classfication/amy_dataset_manifest.csv

#python dataset_merge.py

#python ROI_eval_cv_split.py \
#  --roi-root /scratch/l.peiwang/kari_brainv33_top300 \
#  --vols-roots \
#    /home/l.peiwang/MRI2PET/tau_MGDA_UB_v33_500_1_1/volumes \
#    /home/l.peiwang/MRI2PET/tau_MGDA_UB_v33_500_2/volumes \
#    /home/l.peiwang/MRI2PET/tau_MGDA_UB_v33_500_3/volumes \
#    /home/l.peiwang/MRI2PET/tau_MGDA_UB_v33_500_4/volumes \
#    /home/l.peiwang/MRI2PET/tau_MGDA_UB_v33_500_5/volumes \
#  --meta-csv /scratch/l.peiwang/MR_AMY_TAU_CDR_merge_DF26.csv \
#  --session-col TAU_PET_Session \
#  --split-by centiloid \
#  --thr 18.4\
#  --out /scratch/l.peiwang/tau_MGDA_UB_v33_500_amyloid


#python ROI_eval_cv_split.py \
#  --roi-root /scratch/l.peiwang/kari_brainv33_top300 \
#  --vols-roots \
#    /home/l.peiwang/MRI2PET/MGDA_UB_v33_500_1/volumes \
#    /home/l.peiwang/MRI2PET/MGDA_UB_v33_500_2/volumes \
#    /home/l.peiwang/MRI2PET/MGDA_UB_v33_500_3/volumes \
#    /home/l.peiwang/MRI2PET/MGDA_UB_v33_500_4/volumes \
#    /home/l.peiwang/MRI2PET/MGDA_UB_v33_500_5/volumes \
#  --meta-csv /scratch/l.peiwang/MR_AMY_TAU_CDR_merge_DF26.csv \
#  --session-col TAU_PET_Session \
#  --split-by braak \
#  --thr-braak 1.2 \
#  --out /scratch/l.peiwang/braak_MGDA_UB_v33_500_braak


#python new_class.py \
#  --manifest /scratch/l.peiwang/MRI2PET_svm_out_amyloid/dataset_manifest.csv \
#  --modality mri \
#  --outdir /scratch/l.peiwang/MRI2PET_svm_out_amyloid_from_manifest
